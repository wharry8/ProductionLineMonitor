# 动作(假设程序在生产线开机时启动)
动作主要分为两个部分考虑:
1. 小车
2. 工作台

其中小车动作分为小车1,小车2的动作.
小车1动作包括:
1. 左右平移
2. 获取箱子
3. 失去箱子

小车2动作包括:
1. 左右平移
2. 获取箱子
3. 失去箱子

工作台的动作分为:
1. 料盒上升
2. 料盒下降
3. 机械手移动


## 小车1
2个线程同时运行控制小车1的动画,
线程1根据小车当前的方向和速度移动小车1, 在小车1到达目的时修改小车1的速度为0.
线程2读取状态信息,修改小车1的速度和方向

### 小车1平移逻辑(后动)
```
初始状态:
位置: 上料起始位
速度大小: 0
速度方向: 向右

读取到小车1经过某个位置
如果小车1上一次经过的位置 previousPosition = -1
    令 previousPosition = 当前位置
如果小车1上一次经过的位置 previousPosition != -1
    如果 currentPosition > previousPosition
        如果此时小车1的方向不是向右
            令小车1的方向向右
        如果此时小车1的速度为0
            令小车1的速度为某个速度(具体的速度目前无法确定)
        修改小车1的目的地为当前位置
    如果 currentPosition == previousPosition
        如果小车1的目的地不是当前位置
            修改小车1的目的地为当前位置
    如果 currentPosition < previousPosition 
        如果小车1的方向不是向左
            令小车1的方向向左
        如果小车1的速度为0
            令小车1的速度为某个速度(具体的速度目前无法确定)
        修改小车1的目的地为当前位置
    令前一个位置=当前位置
继续读取下一次状态
```

### 小车1获得箱子逻辑(即时)
根据前后状态来判断小车是否获得箱子.

前一个状态回钩,当前状态出钩,小车在当前位置获得箱子.

### 小车1失去箱子逻辑(即时)

根据前后状态判断小车是否获得箱子.

前一个状态是出钩,当前状态是回钩,小车在当前位置失去箱子.

### 小车1动作需要的信号
编号|说明|信号类型
---|---|---
M6100|小车1到上料起始位|到位信号
M6101|小车1到上料挡停位|到位信号
M6102|小车1到站1储料位|到位信号
M6103|小车1到站1加工位|到位信号
M6104|小车1到站1完成位|到位信号
M6105|小车1到站2储料位|到位信号
M6106|小车1到站2加工位|到位信号
M6107|小车1到站2完成位|到位信号
M6108|小车1到站3储料位|到位信号
M6109|小车1到站3加工位|到位信号
Y592|前钩料气缸回|驱动信号
Y593|前钩料气缸出|驱动信号



## 小车2
2个线程同时运行控制小车2的动画
线程1根据小车2当前的方向和速度移动小车2, 在小车2到达目的时修改小车2的速度为0.
线程2读取状态信息,修改小车2的速度和方向

### 小车2平移逻辑(后动)
```
初始状态:
位置: 站3加工位(两条生产线交接处)
速度大小: 0
速度方向: 向右

// 如果小车2经过某个位置
如果小车2上一次经过的位置 previousPosition = -1 (没有值)
    令 previousPosition = 当前位置
如果小车2上一次经过的位置 previousPosition != -1
    如果 currentPosition > previousPosition
        如果此时小车2的方向不是向右
            令小车2的方向向右
        如果此时小车2的速度为0
            令小车2的速度为某个速度(具体的速度目前无法确定)
        修改小车2的目的地为当前位置
    如果 currentPosition == previousPosition
        如果小车2的目的地不是当前位置
            修改小车2的目的地为当前位置
        如果小车2已经到达目的地
            如果小车2的速度不为0
                令小车2的速度为0
    如果 currentPosition < previousPosition 
        如果小车2的方向不是向左
            令小车2的方向向左
        如果小车2的速度为0
            令小车2的速度为某个速度(具体的速度目前无法确定)
        修改小车2的目的地为当前位置
    令前一个位置=当前位置
    继续读取下一次状态

小车2的速度可以尽量快,可以提前到达位置后进入等待
```

### 小车2获取箱子动作逻辑(即时)
根据连续的两个状态判断
如果上一个状态小车2处于回钩状态,当前状态小车2处于出钩状态,那么小车2获得当前位置的箱子

### 小车2失去箱子动作逻辑(即时)
根据连续的两个状态判断
如果上一个状态小车2处于出钩状态,当前状态小车2处于回钩状态,那么小车2在当前位置失去箱子

### 小车2动画需要的信号
编号|说明|信号类型
---|---|---
M713|后钩料气缸回|驱动信号
M714|后钩料气缸出|驱动信号
M6110|小车2到站3加工位|到位信号
M6111|小车2到站3完成位|到位信号
M6112|小车2到站4储备位|到位信号
M6113|小车2到站4加工位|到位信号
M6114|小车2到站4完成位|到位信号
M6115|小车2到站5储备位|到位信号
M6116|小车2到站5加工位|到位信号
M6117|小车2到下料位|到位信号
M6118|小车2到下料终点|到位信号

## 工作台

工作台的动作同样由两个线程完成

线程1根据料盒/机械臂的速度, 方向移动料盒/机械臂, 在到位时修改速度为0 (可能需要修改其他信息).

线程2读取状态信息, 修改料盒/机械臂的速度, 方向.

工作台的动作有3个部分组成
1. 料盒上升
2. 料盒下降
3. 机械臂移动

机械臂的移动包括:
1. 上下
2. 左右

### 机械臂动作逻辑(即时)
```
如果上下到等待位到位
    如果机械臂还未到达等待位
        如果机械臂的速度为0
            修改机械臂的速度
        如果机械臂的速度不是向上的
            修改机械臂的速度方向
如果上下到取料位到位
    如果机械臂还未到达取料位
        如果机械臂的速度为0
            修改机械臂的速度
        如果机械臂的速度不是向下的
            修改机械臂的速度方向

如果上下到左放料位到位
    如果机械臂的还未到达左放料位
        如果机械臂的速度为0
            修改机械臂的速度
        如果机械臂的速度方向不是向下的
            修改机械臂的速度方向

如果上下到右放料位到位
    如果机械臂还未到达右放料位
        如果机械臂的速度为0
            修改机械臂的速度大小
        如果机械臂的速度方向不是向下的
            修改机械臂的速度方向
如果横移到取料位到位
    如果机械臂还未到达取料位
        如果机械臂当前的位置为左CNC
            如果机械臂的速度大小为0
                修改机械臂的速度大小
            如果机械臂的速度方向不是向右的
                修改机械臂的速度方向
        如果机械臂当前的位置为右CNC
            如果机械臂的速度大小为0
                修改机械臂的速度大小
            如果机械臂的速度方向不是向左的
                修改机械臂的速度方向

如果横移到左放料位到位
    如果机械臂还未到达左放料位
        如果机械臂的速度大小为0
            修改机械臂的速度大小
        如果机械臂的速度方向不是向左的
            修改机械臂的速度方向

修改机械臂的当前位置, 由线程1控制. 当机械臂到达目的地之后, 速度设为0, 当前位置修改为左放料位.

如果横移到右放料位到位
    如果机械臂还未到达右放料未
        如果机械臂的速度大小为0
            修改机械臂的速度大小
        如果机械臂的速度方向不是向右的
            修改机械臂的速度方向

修改机械臂的当前位置, 由线程1控制. 当机械臂到达目的地之后, 速度设为0, 当前位置修改为右放料位.
```


### 料盒上升动作逻辑(即时)
根据前后两次状态判断
如果上一次状态驱动信号**上料位到位=false**,
当前状态驱动信号**上料位到位=true**.
那么修改料盒的速率为某个速率,方向向上,目的地为等待位.

### 料盒下降动作逻辑(即时)
根据前后两次状态判断
如果上一次状态信号**下料位到位=false**,
当前状态信号**下料位到位=true**,
那么修改料盒的速度大小,方向向下,目的地取料位.

### 需要的信号

编号|说明|信号类型|备注
---|---|---|---
M5205|站1加工上料盒到位|到位信号|
M5207|站1加工下料盒到位|到位信号|
M5215|站1储料上料盒到位|到位信号|
M5217|站1储料下料盒到位|到位信号|
|||
M5225|站2加工上料盒到位|到位信号|
M5227|站2加工下料盒到位|到位信号|
M5235|站2储料上料盒到位|到位信号|
M5237|站2储料下料盒到位|到位信号|
|||
M5245|站3加工上料盒到位|到位信号|
M5247|站3加工下料盒到位|到位信号|
M5255|站3储料上料盒到位|到位信号|
M5257|站3储料下料盒到位|到位信号|
|||
M5265|站4加工上料盒到位|到位信号|
M5267|站4加工下料盒到位|到位信号|
M5275|站4储料上料盒到位|到位信号|
M5277|站4储料下料盒到位|到位信号|
|||
M5285|站5加工上料盒到位|到位信号|
M5287|站5加工下料盒到位|到位信号|
M5295|站5储料上料盒到位|到位信号|
M5297|站5储料下料盒到位|到位信号|
|||
M7000|站1上下到等待位|驱动信号|
M7001|站1上下到取料位|驱动信号|
M7002|站1上下到左放料位|驱动信号|
M7003|站1上下到右放料位|驱动信号|
M7004|站1横移到取料位|驱动信号
M7005|站1横移到左放料位|驱动信号
M7006|站1横移到右放料位|驱动信号
|||
M8000|站2上下到等待位|驱动信号|
M8001|站2上下到取料位|驱动信号|
M8002|站2上下到左放料位|驱动信号|
M8003|站2上下到右放料位|驱动信号|
M8004|站2横移到取料位|驱动信号
M8005|站2横移到左放料位|驱动信号
M8006|站2横移到右放料位|驱动信号
|||
M8040|站3上下到等待位|驱动信号|
M8041|站3上下到取料位|驱动信号|
M8042|站3上下到左放料位|驱动信号|
M8043|站3上下到右放料位|驱动信号|
M8044|站3横移到取料位|驱动信号
M8045|站3横移到左放料位|驱动信号
M8046|站3横移到右放料位|驱动信号
|||
M8080|站4上下到等待位|驱动信号|
M8081|站4上下到取料位|驱动信号|
M8082|站4上下到左放料位|驱动信号|
M8083|站4上下到右放料位|驱动信号|
M8084|站4横移到取料位|驱动信号
M8085|站4横移到左放料位|驱动信号
M8086|站4横移到右放料位|驱动信号
|||
M8120|站5上下到等待位|驱动信号|
M8121|站5上下到取料位|驱动信号|
M8122|站5上下到左放料位|驱动信号|
M8123|站5上下到右放料位|驱动信号|
M8124|站5横移到取料位|驱动信号
M8125|站5横移到左放料位|驱动信号
M8126|站5横移到右放料位|驱动信号



# 其他问题

1. 断线重连

   如果程序在生产线运行途中开启, 需要哪些信号来判断当前的状态, 接下来的动作该怎么做?

2. ​



